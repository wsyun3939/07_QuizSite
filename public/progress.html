<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>é€²æ—ä¸€è¦§</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="light dark" />
  <style>
    :root{
      --bg:#f7f7f7; --panel:#fff; --text:#333; --muted:#666;
      --border:#dcdcdc; --ring:#80bfff;
      --primary:#0d6efd; --primary-600:#0b5ed7;
      --danger:#dc3545; --danger-600:#bb2d3b;
      --gray:#6c757d; --gray-600:#5a6268;
      --radius:10px; --shadow:0 4px 15px rgba(0,0,0,.08);
    }
    @media (prefers-color-scheme: dark){
      :root{
        --bg:#0f1115; --panel:#171a21; --text:#e8eaf0; --muted:#aab1c6;
        --border:#2a2f3a; --ring:#5ab0ff;
        --shadow:0 6px 20px rgba(0,0,0,.35);
      }
    }

    *{box-sizing:border-box}
    body{
      font-family: system-ui, -apple-system, "Segoe UI", Roboto,
                   "Hiragino Kaku Gothic ProN", "Noto Sans JP", sans-serif;
      margin:0; padding:20px; background:var(--bg); color:var(--text);
    }
    h1{ text-align:center; margin: 8px 0 20px; letter-spacing:.02em; }

    .controls{
      display:flex; justify-content:center; align-items:center; gap:12px;
      margin: 0 auto 18px; flex-wrap: wrap; max-width: 1000px;
    }
    select, button{
      font-size:16px; padding:8px 12px; border-radius:8px;
      border:1px solid var(--border); background:#fff; color:var(--text);
      min-height:40px;
    }
    @media (prefers-color-scheme: dark){ select{ background:#151a24; } }
    select:focus-visible, button:focus-visible{
      outline:3px solid var(--ring); outline-offset:2px;
    }

    .reset-all-btn{ background:var(--danger); color:#fff; border:none; cursor:pointer; }
    .reset-all-btn:hover{ background:var(--danger-600); }
    .back-btn{ background:var(--gray); color:#fff; border:none; cursor:pointer; }
    .back-btn:hover{ background:var(--gray-600); }

    .table-wrap{
      background: var(--panel); border:1px solid var(--border);
      border-radius: var(--radius); box-shadow: var(--shadow);
      overflow:auto;  /* æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯¾å¿œ */
    }
    table{ width:100%; border-collapse: collapse; min-width: 720px; }
    th, td{ border-bottom:1px solid var(--border); padding:10px; text-align:center; }
    thead th{
      position: sticky; top: 0; z-index: 1;
      background: var(--primary); color:#fff; text-align:center;
    }
    tbody tr:nth-child(even){ background: rgba(0,0,0,.03); }
    @media (prefers-color-scheme: dark){
      tbody tr:nth-child(even){ background: rgba(255,255,255,.03); }
    }

    .reset-btn{
      background: var(--danger); color:#fff; border:none; border-radius:6px;
      padding:6px 10px; cursor:pointer;
    }
    .reset-btn:hover{ background: var(--danger-600); }

    .summary{
      max-width:1000px; margin:12px auto 0; color: var(--muted); font-size:14px;
      display:flex; gap:12px; justify-content:center; flex-wrap:wrap;
    }

    .sr-only{
      position:absolute!important; width:1px; height:1px; padding:0; margin:-1px;
      overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0;
    }
  </style>
</head>
<body>
  <h1>ã‚¯ã‚¤ã‚ºé€²æ—ä¸€è¦§</h1>

  <div class="controls" role="group" aria-label="é€²æ—æ“ä½œ">
    <label for="genreFilter">ã‚¸ãƒ£ãƒ³ãƒ«ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼:</label>
    <select id="genreFilter">
      <option value="all">ã™ã¹ã¦</option>
    </select>
    <button class="reset-all-btn" id="resetAllBtn">ğŸ—‘ï¸ å…¨é€²æ—ã‚’ãƒªã‚»ãƒƒãƒˆ</button>
    <button class="back-btn" id="back-button">ğŸ  ãƒˆãƒƒãƒ—ã¸æˆ»ã‚‹</button>
  </div>

  <div class="table-wrap">
    <table id="progress-table" aria-describedby="table-caption">
      <caption id="table-caption" class="sr-only">ä¿å­˜ã•ã‚Œã¦ã„ã‚‹å„ã‚«ãƒ†ã‚´ãƒªã®é€²æ—ä¸€è¦§</caption>
      <thead>
        <tr>
          <th>ã‚¸ãƒ£ãƒ³ãƒ«</th>
          <th>å½¢å¼</th>
          <th>é›£æ˜“åº¦</th>
          <th>ç¾åœ¨ã®å•é¡Œç•ªå·</th>
          <th>ã‚¹ã‚³ã‚¢</th>
          <th>æ“ä½œ</th>
        </tr>
      </thead>
      <tbody id="table-body">
        <!-- JSã§ç”Ÿæˆ -->
      </tbody>
    </table>
  </div>

  <div class="summary" id="summary"></div>
  <div id="status" aria-live="polite" class="sr-only"></div>

  <script>
    (() => {
      'use strict';

      const genres = [
        'animeandgame','sports','lifestyle',
        'entertainment','society','humanities','science'
      ];
      const genreNames = {
        animeandgame:'ã‚¢ãƒ‹ãƒ¡andã‚²ãƒ¼ãƒ ', sports:'ã‚¹ãƒãƒ¼ãƒ„', lifestyle:'ãƒ©ã‚¤ãƒ•ã‚¹ã‚¿ã‚¤ãƒ«',
        entertainment:'èŠ¸èƒ½', society:'ç¤¾ä¼š', humanities:'æ–‡ç³»å­¦å•', science:'ç†ç³»å­¦å•'
      };
      const types = ['MCQ','GROUP'];
      const levels = [1,2,3,4,5];

      const tableBody   = document.getElementById('table-body');
      const genreFilter = document.getElementById('genreFilter');
      const backBtn     = document.getElementById('back-button');
      const resetAllBtn = document.getElementById('resetAllBtn');
      const summaryEl   = document.getElementById('summary');
      const statusEl    = document.getElementById('status');

      const setStatus = (msg)=>{ if(statusEl) statusEl.textContent = msg; };

      // ãƒ•ã‚£ãƒ«ã‚¿é¸æŠè‚¢ã‚’åˆæœŸåŒ–
      (function initGenreSelect(){
        genres.forEach(g=>{
          const opt = document.createElement('option');
          opt.value = g; opt.textContent = genreNames[g] || g;
          genreFilter.appendChild(opt);
        });
        // å‰å›ã®é¸æŠã‚’å¾©å…ƒ
        const saved = localStorage.getItem('progress_filter_genre');
        if (saved && [...genreFilter.options].some(o => o.value === saved)) {
          genreFilter.value = saved;
        }
      })();

      function keyBaseOf(genre,type,level){ return `progress_${genre}_${type}_${level}`; }

      function updateSummary(rows){
        if(!summaryEl) return;
        const count = rows.length;
        const sumScore = rows.reduce((s,r)=> s + (r.scoreNum ?? 0), 0);
        summaryEl.textContent = count
          ? `è¡¨ç¤ºä»¶æ•°ï¼š${count}ã€€ï½œã€€åˆè¨ˆã‚¹ã‚³ã‚¢ï¼š${sumScore}`
          : `ä¿å­˜ã•ã‚ŒãŸé€²æ—ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚`;
      }

      function updateTable(){
        tableBody.innerHTML = '';
        const selected = genreFilter.value || 'all';

        const rows = [];
        genres.forEach(genre=>{
          types.forEach(type=>{
            levels.forEach(level=>{
              const key = keyBaseOf(genre,type,level);
              const index = localStorage.getItem(`${key}_index`);
              const score = localStorage.getItem(`${key}_score`);
              const show  = (index!==null || score!==null) && (selected==='all' || selected===genre);
              if(!show) return;

              const scoreNum = Number(score);
              rows.push({genre,type,level,index,score,scoreNum, key});
            });
          });
        });

        if(rows.length === 0){
          const empty = document.createElement('tr');
          empty.innerHTML = `<td colspan="6" style="padding:16px; color:var(--muted);">é€²æ—ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</td>`;
          tableBody.appendChild(empty);
          updateSummary(rows);
          return;
        }

        // è¡¨ç¤ºï¼šã‚¸ãƒ£ãƒ³ãƒ«â†’å½¢å¼â†’é›£æ˜“åº¦ã§ã‚½ãƒ¼ãƒˆï¼ˆä»»æ„ï¼‰
        rows.sort((a,b)=>{
          const g = a.genre.localeCompare(b.genre);
          if(g!==0) return g;
          const t = a.type.localeCompare(b.type);
          if(t!==0) return t;
          return a.level - b.level;
        });

        // ãƒ†ãƒ¼ãƒ–ãƒ«æç”»
        const frag = document.createDocumentFragment();
        rows.forEach(r=>{
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${genreNames[r.genre] || r.genre}</td>
            <td>${r.type}</td>
            <td>${r.level}</td>
            <td>${r.index ?? '-'}</td>
            <td>${r.score ?? '-'}</td>
            <td><button class="reset-btn" data-key="${r.key}">ãƒªã‚»ãƒƒãƒˆ</button></td>
          `;
          frag.appendChild(tr);
        });
        tableBody.appendChild(frag);
        updateSummary(rows);
      }

      // è¡Œã®ã€Œãƒªã‚»ãƒƒãƒˆã€ï¼šã‚¤ãƒ™ãƒ³ãƒˆå§”è­²ã§å¯¾å¿œ
      tableBody.addEventListener('click', (e)=>{
        const btn = e.target.closest('.reset-btn');
        if(!btn) return;
        const key = btn.dataset.key;
        if(!key) return;

        if(confirm(`${key} ã®é€²æ—ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)){
          localStorage.removeItem(`${key}_index`);
          localStorage.removeItem(`${key}_score`);
          setStatus(`å‰Šé™¤: ${key}`);
          updateTable();
        }
      });

      // å…¨æ¶ˆã—ï¼šprogress_ ã§å§‹ã¾ã‚‹ã‚­ãƒ¼ã‚’ä¸€æ‹¬ã«ï¼ˆæœªçŸ¥ã®çµ„åˆã›ã«ã‚‚å¯¾å¿œï¼‰
      resetAllBtn.addEventListener('click', ()=>{
        if(!confirm("å…¨ã‚¸ãƒ£ãƒ³ãƒ«ãƒ»å…¨å½¢å¼ãƒ»å…¨ãƒ¬ãƒ™ãƒ«ã®é€²æ—ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) return;
        for(let i = localStorage.length - 1; i >= 0; i--){
          const k = localStorage.key(i);
          if(k && k.startsWith('progress_')) localStorage.removeItem(k);
        }
        setStatus('å…¨é€²æ—ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚');
        updateTable();
        alert("å…¨é€²æ—ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚");
      });

      // ãƒ•ã‚£ãƒ«ã‚¿å¤‰æ›´
      genreFilter.addEventListener('change', ()=>{
        localStorage.setItem('progress_filter_genre', genreFilter.value);
        updateTable();
      });

      // æˆ»ã‚‹
      document.getElementById('back-button').addEventListener('click', ()=>{
        window.location.href = 'index.html';
      });

      // åˆæœŸæç”»
      updateTable();
    })();
  </script>
</body>
</html>
